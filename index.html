<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Borderô - Feijoada do Nosso Tom</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      max-width: 1000px;
      margin: auto;
      background-color: white;
      color: black;
    }
    h1, h2 {
      color: black;
    }
    input, textarea, button {
      margin: 5px 0;
      padding: 8px;
      width: 100%;
      box-sizing: border-box;
    }
    .section {
      margin-bottom: 30px;
    }
    .btn {
      background-color: #333;
      color: white;
      border: none;
      cursor: pointer;
    }
    .btn:hover {
      opacity: 0.9;
    }
    ul {
      padding-left: 20px;
    }
    ul li {
      color: black;
      margin-bottom: 5px;
    }
    .delete-btn {
      background-color: red;
      color: white;
      border: none;
      padding: 2px 6px;
      margin-left: 10px;
      cursor: pointer;
    }
    .total {
      font-weight: bold;
      margin-top: 10px;
    }
  </style>
</head>
<body>
  <h1>Controle de Borderô - Feijoada do Nosso Tom</h1>

  <div class="section">
    <h2>Ingressos Vendidos Antecipados</h2>
    <input id="setorInput" placeholder="Setor (Ex: Pista, Camarote)" onkeydown="if(event.key==='Enter') adicionar('Ingressos')">
    <input type="number" id="qtdIngressoInput" placeholder="Quantidade" onkeydown="if(event.key==='Enter') adicionar('Ingressos')">
    <input type="number" id="valorIngressoInput" placeholder="Valor Total (opcional)" onkeydown="if(event.key==='Enter') adicionar('Ingressos')">
    <button class="btn" onclick="adicionar('Ingressos')">Adicionar</button>
    <ul id="listaIngressos"></ul>
    <div class="total">Total: <span id="totalIngressos">0</span></div>
  </div>

  <div class="section">
    <h2>Ingressos Vendidos na Bilheteria</h2>
    <input id="setorBilheteria" placeholder="Setor (Ex: Pista, Camarote)" onkeydown="if(event.key==='Enter') adicionar('Bilheteria')">
    <input type="number" id="qtdBilheteria" placeholder="Quantidade" onkeydown="if(event.key==='Enter') adicionar('Bilheteria')">
    <input type="number" id="valorBilheteria" placeholder="Valor Total (opcional)" onkeydown="if(event.key==='Enter') adicionar('Bilheteria')">
    <button class="btn" onclick="adicionar('Bilheteria')">Adicionar</button>
    <ul id="listaBilheteria"></ul>
    <div class="total">Total: <span id="totalBilheteria">0</span></div>
  </div>

  <div class="section">
    <h2>Liberações Nabêra</h2>
    <input id="nomeNabera" placeholder="Nome de quem liberou" onkeydown="if(event.key==='Enter') adicionar('Nabera')">
    <input type="number" id="qtdNabera" placeholder="Quantidade" onkeydown="if(event.key==='Enter') adicionar('Nabera')">
    <input id="destinoNabera" placeholder="Nome da pessoa liberada (opcional)" onkeydown="if(event.key==='Enter') adicionar('Nabera')">
    <button class="btn" onclick="adicionar('Nabera')">Adicionar</button>
    <ul id="listaNabera"></ul>
  </div>

  <div class="section">
    <h2>Liberações Nosso Tom</h2>
    <input id="nomeNossoTom" placeholder="Nome de quem liberou" onkeydown="if(event.key==='Enter') adicionar('NossoTom')">
    <input type="number" id="qtdNossoTom" placeholder="Quantidade" onkeydown="if(event.key==='Enter') adicionar('NossoTom')">
    <input id="destinoNossoTom" placeholder="Nome da pessoa liberada (opcional)" onkeydown="if(event.key==='Enter') adicionar('NossoTom')">
    <button class="btn" onclick="adicionar('NossoTom')">Adicionar</button>
    <ul id="listaNossoTom"></ul>
  </div>

  <div class="section">
    <h2>Abadás Disponíveis</h2>
    <input type="number" id="abadasDisponiveis" placeholder="Quantidade" onkeydown="if(event.key==='Enter') adicionar('Disponiveis')">
    <button class="btn" onclick="adicionar('Disponiveis')">Adicionar</button>
    <ul id="listaDisponiveis"></ul>
  </div>

  <div class="section">
    <h2>Abadás Entregues</h2>
    <input type="number" id="abadasEntregues" placeholder="Quantidade" onkeydown="if(event.key==='Enter') adicionar('Entregues')">
    <button class="btn" onclick="adicionar('Entregues')">Adicionar</button>
    <ul id="listaEntregues"></ul>
  </div>

  <div class="section">
    <h2>Observações</h2>
    <textarea id="obsInput" placeholder="Digite uma observação" onkeydown="if(event.key==='Enter') adicionar('Obs')"></textarea>
    <button class="btn" onclick="adicionar('Obs')">Adicionar</button>
    <ul id="listaObs"></ul>
  </div>

  <div class="section">
    <button class="btn" onclick="gerarBorderoNaTela()">Ver Borderô na Tela</button>
    <button class="btn" onclick="exportarPDF()">Exportar Borderô em PDF</button>
  </div>

<script>
function adicionar(tipo) {
  let nome = '', qtd = 0, destino = '', valor = '', listaId = '', totalId = '';
  if (tipo === 'Ingressos') {
    nome = document.getElementById("setorInput").value.trim();
    qtd = parseInt(document.getElementById("qtdIngressoInput").value);
    valor = document.getElementById("valorIngressoInput").value.trim();
    listaId = "listaIngressos";
    totalId = "totalIngressos";
  } else if (tipo === 'Bilheteria') {
    nome = document.getElementById("setorBilheteria").value.trim();
    qtd = parseInt(document.getElementById("qtdBilheteria").value);
    valor = document.getElementById("valorBilheteria").value.trim();
    listaId = "listaBilheteria";
    totalId = "totalBilheteria";
  } else if (tipo === 'Nabera') {
    nome = document.getElementById("nomeNabera").value.trim();
    qtd = parseInt(document.getElementById("qtdNabera").value);
    destino = document.getElementById("destinoNabera").value.trim();
    listaId = "listaNabera";
  } else if (tipo === 'NossoTom') {
    nome = document.getElementById("nomeNossoTom").value.trim();
    qtd = parseInt(document.getElementById("qtdNossoTom").value);
    destino = document.getElementById("destinoNossoTom").value.trim();
    listaId = "listaNossoTom";
  } else if (tipo === 'Disponiveis') {
    nome = 'Abadás Disponíveis';
    qtd = parseInt(document.getElementById("abadasDisponiveis").value);
    listaId = "listaDisponiveis";
  } else if (tipo === 'Entregues') {
    nome = 'Abadás Entregues';
    qtd = parseInt(document.getElementById("abadasEntregues").value);
    listaId = "listaEntregues";
  } else if (tipo === 'Obs') {
    const obs = document.getElementById("obsInput").value.trim();
    if (obs) {
      const li = document.createElement("li");
      li.textContent = obs;
      const btn = document.createElement("button");
      btn.textContent = "Excluir";
      btn.className = "delete-btn";
      btn.onclick = () => li.remove();
      li.appendChild(btn);
      document.getElementById("listaObs").appendChild(li);
      document.getElementById("obsInput").value = "";
    }
    return;
  }

  if (!nome || isNaN(qtd)) return;
  const lista = document.getElementById(listaId);
  const key = `${nome}|${destino}`;
  const itens = Array.from(lista.children);
  const existente = itens.find(li => li.dataset.key === key);

  const descricao = `${nome}${destino ? ' → ' + destino : ''}` + `: ${qtd} ${(tipo === 'Ingressos' || tipo === 'Bilheteria') ? 'ingresso(s)' : 'liberação(oes)'}` + (valor ? ` - R$ ${valor}` : '');

  if (existente) {
    const atual = parseInt(existente.dataset.qtd);
    const novo = atual + qtd;
    existente.dataset.qtd = novo;
    existente.firstChild.textContent = descricao.replace(qtd, novo);
  } else {
    const li = document.createElement("li");
    li.dataset.key = key;
    li.dataset.qtd = qtd;
    li.innerHTML = descricao + ` <button class='delete-btn' onclick='this.parentElement.remove(); atualizarTotal("${listaId}", "${totalId}")'>Excluir</button>`;
    lista.appendChild(li);
  }

  if (totalId) atualizarTotal(listaId, totalId);
  const clearInputs = ['setorInput','qtdIngressoInput','valorIngressoInput','setorBilheteria','qtdBilheteria','valorBilheteria','nomeNabera','qtdNabera','destinoNabera','nomeNossoTom','qtdNossoTom','destinoNossoTom','abadasDisponiveis','abadasEntregues'];
  clearInputs.forEach(id => { if(document.getElementById(id)) document.getElementById(id).value = "" });
}

function atualizarTotal(listaId, totalId) {
  const lista = document.getElementById(listaId);
  let total = 0;
  for (let item of lista.children) {
    total += parseInt(item.dataset.qtd || 0);
  }
  document.getElementById(totalId).innerText = total;
}

function gerarBorderoNaTela() {
  const win = window.open('', '_blank');
  win.document.write('<html><head><title>Borderô</title></head><body>');
  win.document.write('<h1>Borderô - Feijoada do Nosso Tom</h1>');
  const sections = ['listaIngressos','listaBilheteria','listaNabera','listaNossoTom','listaDisponiveis','listaEntregues','listaObs'];
  for (let id of sections) {
    const lista = document.getElementById(id);
    if (lista.children.length > 0) {
      win.document.write(`<h2>${lista.previousElementSibling.innerText}</h2><ul>`);
      for (let item of lista.children) {
        win.document.write(`<li>${item.innerText.replace('Excluir','')}</li>`);
      }
      win.document.write('</ul>');
    }
  }
  win.document.write('</body></html>');
  win.document.close();
}

async function exportarPDF() {
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();
  let y = 10;
  doc.setFontSize(16);
  doc.text("Borderô - Feijoada do Nosso Tom", 10, y);
  y += 10;

  const sections = [
    { id: 'listaIngressos', title: 'Ingressos Vendidos Antecipados' },
    { id: 'listaBilheteria', title: 'Ingressos Vendidos na Bilheteria' },
    { id: 'listaNabera', title: 'Liberações Nabêra' },
    { id: 'listaNossoTom', title: 'Liberações Nosso Tom' },
    { id: 'listaDisponiveis', title: 'Abadás Disponíveis' },
    { id: 'listaEntregues', title: 'Abadás Entregues' },
    { id: 'listaObs', title: 'Observações' }
  ];

  for (const sec of sections) {
    const lista = document.getElementById(sec.id);
    if (lista.children.length > 0) {
      doc.setFontSize(14);
      doc.text(sec.title, 10, y);
      y += 8;
      doc.setFontSize(12);
      for (let item of lista.children) {
        const text = item.innerText.replace('Excluir', '').trim();
        const lines = doc.splitTextToSize(text, 180);
        for (const line of lines) {
          if (y > 280) {
            doc.addPage();
            y = 10;
          }
          doc.text(line, 10, y);
          y += 6;
        }
      }
      y += 6;
    }
  }

  doc.save("bordero-nosso-tom.pdf");
}
</script>
</body>
</html>
