<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Borderô - Feijoada do Nosso Tom</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      max-width: 1000px;
      margin: auto;
      background-color: white;
      color: black;
    }
    h1, h2, h3 {
      color: black;
    }
    input, textarea, select, button {
      margin: 5px 0;
      padding: 8px;
      width: 100%;
      box-sizing: border-box;
    }
    .section {
      margin-bottom: 30px;
    }
    .btn {
      background-color: #333;
      color: white;
      border: none;
      cursor: pointer;
    }
    .btn:hover {
      opacity: 0.9;
    }
    ul {
      padding-left: 20px;
    }
    ul li {
      color: black;
      margin-bottom: 5px;
    }
    .delete-btn {
      background-color: red;
      color: white;
      border: none;
      padding: 2px 6px;
      margin-left: 10px;
      cursor: pointer;
    }
    .total {
      font-weight: bold;
      margin-top: 10px;
    }
  </style>
</head>
<body>
  <h1>Controle de Borderô - Feijoada do Nosso Tom</h1>

  <div class="section">
    <h2>Ingressos Vendidos Antecipados</h2>
    <input id="setorInput" placeholder="Setor (Ex: Pista, Camarote)" onkeydown="if(event.key==='Enter') adicionarOuSomar('Ingressos')">
    <input type="number" id="qtdIngressoInput" placeholder="Quantidade" onkeydown="if(event.key==='Enter') adicionarOuSomar('Ingressos')">
    <input type="number" id="valorIngressoInput" placeholder="Valor Total (opcional)" onkeydown="if(event.key==='Enter') adicionarOuSomar('Ingressos')">
    <button class="btn" onclick="adicionarOuSomar('Ingressos')">Adicionar</button>
    <ul id="listaIngressos"></ul>
    <div class="total">Total: <span id="totalIngressos">0</span></div>
  </div>

  <div class="section">
    <h2>Ingressos Vendidos na Bilheteria</h2>
    <input type="text" id="setorBilheteria" placeholder="Setor (ex: Pista, Camarote)" onkeypress="if(event.key==='Enter') adicionarOuSomar('Bilheteria')" />
    <input type="number" id="qtdBilheteria" placeholder="Quantidade" onkeypress="if(event.key==='Enter') adicionarOuSomar('Bilheteria')" />
    <input type="number" id="valorBilheteria" placeholder="Valor Total (opcional)" onkeypress="if(event.key==='Enter') adicionarOuSomar('Bilheteria')" />
    <button class="btn" onclick="adicionarOuSomar('Bilheteria')">Adicionar</button>
    <ul id="listaBilheteria"></ul>
    <div class="total">Total: <span id="totalBilheteria">0</span></div>
  </div>

  <div class="section">
    <button class="btn" onclick="gerarBorderoNaTela()">Ver Borderô na Tela</button>
    <button class="btn" onclick="exportarPDF()">Exportar Borderô em PDF</button>
  </div>

<script>
function adicionarOuSomar(tipo) {
  let nome, qtd, destino = '', valor = '', listaId, totalId;
  if (tipo === 'Ingressos') {
    nome = document.getElementById("setorInput").value.trim();
    qtd = parseInt(document.getElementById("qtdIngressoInput").value);
    valor = document.getElementById("valorIngressoInput").value.trim();
    listaId = "listaIngressos";
    totalId = "totalIngressos";
  } else if (tipo === 'Bilheteria') {
    nome = document.getElementById("setorBilheteria").value.trim();
    qtd = parseInt(document.getElementById("qtdBilheteria").value);
    valor = document.getElementById("valorBilheteria").value.trim();
    listaId = "listaBilheteria";
    totalId = "totalBilheteria";
  } else {
    return;
  }

  if (!nome || isNaN(qtd)) return;
  const lista = document.getElementById(listaId);
  const key = nome;
  const itens = Array.from(lista.children);
  const existente = itens.find(li => li.dataset.key === key);

  if (existente) {
    const atual = parseInt(existente.dataset.qtd);
    const novo = atual + qtd;
    existente.dataset.qtd = novo;
    existente.firstChild.textContent = `${nome}: ${novo} ingresso(s)` + (valor ? ` - R$ ${valor}` : "");
  } else {
    const li = document.createElement("li");
    li.dataset.key = key;
    li.dataset.qtd = qtd;
    li.innerHTML = `${nome}: ${qtd} ingresso(s)` + (valor ? ` - R$ ${valor}` : "") + ` <button class='delete-btn' onclick='this.parentElement.remove(); atualizarTotal("${listaId}", "${totalId}")'>Excluir</button>`;
    lista.appendChild(li);
  }

  if (tipo === 'Ingressos') {
    document.getElementById("setorInput").value = "";
    document.getElementById("qtdIngressoInput").value = "";
    document.getElementById("valorIngressoInput").value = "";
  } else if (tipo === 'Bilheteria') {
    document.getElementById("setorBilheteria").value = "";
    document.getElementById("qtdBilheteria").value = "";
    document.getElementById("valorBilheteria").value = "";
  }

  atualizarTotal(listaId, totalId);
}

function atualizarTotal(listaId, totalId) {
  const lista = document.getElementById(listaId);
  let total = 0;
  for (let item of lista.children) {
    total += parseInt(item.dataset.qtd || 0);
  }
  document.getElementById(totalId).innerText = total;
}

function gerarBorderoNaTela() {
  const borderoWindow = window.open('', '_blank');
  borderoWindow.document.write('<html><head><title>Borderô</title></head><body>');
  borderoWindow.document.write('<h1>Borderô - Feijoada do Nosso Tom</h1>');
  const sections = ["Ingressos", "Bilheteria"];
  sections.forEach(id => {
    const lista = document.getElementById(`lista${id}`);
    if (lista.children.length > 0) {
      borderoWindow.document.write(`<h2>${id === 'Ingressos' ? 'Ingressos Vendidos Antecipados' : 'Ingressos Vendidos na Bilheteria'}</h2><ul>`);
      for (let item of lista.children) {
        borderoWindow.document.write(`<li>${item.innerText.replace('Excluir','')}</li>`);
      }
      borderoWindow.document.write('</ul>');
    }
  });
  borderoWindow.document.write('</body></html>');
  borderoWindow.document.close();
}

async function exportarPDF() {
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();
  let y = 10;
  doc.setFontSize(16);
  doc.text("Borderô - Feijoada do Nosso Tom", 10, y);
  y += 10;

  const sections = [
    { id: 'listaIngressos', title: 'Ingressos Vendidos Antecipados' },
    { id: 'listaBilheteria', title: 'Ingressos Vendidos na Bilheteria' }
  ];

  for (const sec of sections) {
    const lista = document.getElementById(sec.id);
    if (lista.children.length > 0) {
      doc.setFontSize(14);
      doc.text(sec.title, 10, y);
      y += 8;
      doc.setFontSize(12);
      for (let item of lista.children) {
        const text = item.innerText.replace('Excluir', '').trim();
        const lines = doc.splitTextToSize(text, 180);
        for (const line of lines) {
          if (y > 280) {
            doc.addPage();
            y = 10;
          }
          doc.text(line, 10, y);
          y += 6;
        }
      }
      y += 6;
    }
  }

  doc.save("bordero-nosso-tom.pdf");
}
</script>
</body>
</html>
